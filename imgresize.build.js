var doColorBookH,doColorBookW,edgeDetect,edgeDetectLines,edgeDetection,imgResize,imgSmartResize,loadImage;loadImage=function(options){"use strict";var canvas,cxt,img,imgsrc;canvas=(typeof options.canvas!=="string"?options.canvas:document.getElementById(options.canvas));imgsrc=(options.img!==undefined?(typeof options.img!=="string"?options.img.src:options.img):canvas.getAttribute("data-src"));cxt=void 0;img=void 0;canvas.setAttribute("data-src",imgsrc);cxt=canvas.getContext("2d");img=new Image();img.onload=function(){return cxt.drawImage(img,0,0)};return img.src=imgsrc};edgeDetection=function(input,baseColor,grey,context,canvas){"use strict";var b,b1,b2,bc,bn,bp,bytesPerRow,centerRow,factor,g,g1,g2,gc,gn,gp,h,hm1,inputData,nextRow,output,outputData,pixel,priorRow,r,r1,r2,rc,rn,rp,w,wm1,x,y;output=context.createImageData(canvas.width,canvas.height);w=input.width;h=input.height;inputData=input.data;outputData=output.data;bytesPerRow=w*4;pixel=bytesPerRow+4;hm1=h-1;wm1=w-1;centerRow=void 0;priorRow=void 0;nextRow=void 0;factor=void 0;r1=void 0;g1=void 0;b1=void 0;rp=void 0;rc=void 0;rn=void 0;r2=void 0;gp=void 0;gc=void 0;gn=void 0;g2=void 0;bp=void 0;bc=void 0;bn=void 0;b2=void 0;r=void 0;g=void 0;b=void 0;x=void 0;y=void 0;y=1;while(y<hm1){centerRow=pixel-4;priorRow=centerRow-bytesPerRow;nextRow=centerRow+bytesPerRow;r1=-inputData[priorRow]-inputData[centerRow]-inputData[nextRow];g1=-inputData[priorRow+=1]-inputData[centerRow+=1]-inputData[nextRow+=1];b1=-inputData[priorRow+=1]-inputData[centerRow+=1]-inputData[nextRow+=1];rp=inputData[priorRow+=2];rc=inputData[centerRow+=2];rn=inputData[nextRow+=2];r2=-rp-rc-rn;gp=inputData[priorRow+=1];gc=inputData[centerRow+=1];gn=inputData[nextRow+=1];g2=-gp-gc-gn;bp=inputData[priorRow+=1];bc=inputData[centerRow+=1];bn=inputData[nextRow+=1];b2=-bp-bc-bn;x=1;while(x<wm1){centerRow=pixel+4;priorRow=centerRow-bytesPerRow;nextRow=centerRow+bytesPerRow;r=baseColor+r1-rp-(rc*-8)-rn;g=baseColor+g1-gp-(gc*-8)-gn;b=baseColor+b1-bp-(bc*-8)-bn;r1=r2;g1=g2;b1=b2;rp=inputData[priorRow];rc=inputData[centerRow];rn=inputData[nextRow];r2=-rp-rc-rn;gp=inputData[priorRow+=1];gc=inputData[centerRow+=1];gn=inputData[nextRow+=1];g2=-gp-gc-gn;bp=inputData[priorRow+=1];bc=inputData[centerRow+=1];bn=inputData[nextRow+=1];b2=-bp-bc-bn;if(!grey){outputData[pixel]=r+r2;outputData[pixel+=1]=g+g2;outputData[pixel+=1]=b+b2}else{factor=0.3*(r+r2)+0.59*(g+g2)+0.11*(b+b2);outputData[pixel]=factor;outputData[pixel+=1]=factor;outputData[pixel+=1]=factor}outputData[pixel+=1]=255;pixel+=1;x+=1}pixel+=8;y+=1}return output};doColorBookH=function(input,cxt,canvas){"use strict";var h,i,maxData,minData,newData,output,outputData,pixel,w,x,y;w=input.width;h=input.height;output=edgeDetection(input,255,1,cxt,canvas);outputData=output.data;newData=[];maxData=false;minData=false;pixel=0;y=void 0;x=void 0;i=void 0;y=0;while(y<h){x=0;while(x<w){if(outputData[pixel]<240){if(newData[y]===undefined){newData[y]=0}newData[y]+=1}else{if(newData[y]===undefined){newData[y]=0}}if((newData[y]<minData)||(!minData)){minData=newData[y]}if((newData[y]>maxData)||(!maxData)){maxData=newData[y]}pixel+=4;x+=1}y+=1}i=0;while(i<newData.length){newData[i]=parseInt((newData[i]-minData)/(maxData-minData)*255,10);i+=1}return newData};doColorBookW=function(input,cxt,canvas){"use strict";var h,i,maxData,minData,newData,output,outputData,pixel,w,x,y;w=input.width;h=input.height;output=edgeDetection(input,255,1,cxt,canvas);outputData=output.data;newData=[];maxData=false;minData=false;pixel=0;y=void 0;x=void 0;i=void 0;y=0;while(y<h){x=0;while(x<w){if(outputData[pixel]<240){if(newData[x]===undefined){newData[x]=0}newData[x]+=1}else{if(newData[x]===undefined){newData[x]=0}}if((newData[x]<minData)||(!minData)){minData=newData[x]}if((newData[x]>maxData)||(!maxData)){maxData=newData[x]}pixel+=4;x+=1}y+=1}i=0;while(i<newData.length){newData[i]=parseInt((newData[i]-minData)/(maxData-minData)*255,10);i+=1}return newData};edgeDetect=function(options){"use strict";var canvas,cxt,input;canvas=(typeof options.canvas!=="string"?options.canvas:document.getElementById(options.canvas));cxt=canvas.getContext("2d");input=cxt.getImageData(0,0,canvas.width,canvas.height);edgeDetectLines[0]=doColorBookW(input,cxt,document.getElementById("originalCanvas"));edgeDetectLines[1]=doColorBookH(input,cxt,document.getElementById("originalCanvas"));document.getElementById("json").innerHTML=JSON.stringify(edgeDetectLines);return edgeDetectLines};imgResize=function(options){"use strict";var canvas,cxt,height,img,imgsrc,width;canvas=(typeof options.canvas!=="string"?options.canvas:document.getElementById(options.canvas));imgsrc=(options.img!==undefined?(typeof options.img!=="string"?options.img.src:options.img):canvas.getAttribute("data-src"));height=(options.height!==undefined?options.height:canvas.getAttribute("height"));width=(options.width!==undefined?options.width:canvas.getAttribute("width"));cxt=void 0;img=void 0;canvas.setAttribute("width",width);canvas.setAttribute("height",height);cxt=canvas.getContext("2d");img=new Image();img.src=imgsrc;return cxt.drawImage(img,0,0,width,height)};imgSmartResize=function(options){var boringLines,canvas,cxt,height,ignoreCols,ignoreRows,img,imgsrc,ocanvas,ocxt,opixel,original,outputData,pixel,width,x,y;boringLines=function(linesArray,max){var higharray,highest,i;highest=void 0;i=void 0;higharray=[];max=(max===undefined?linesArray.length:(max>linesArray.length?linesArray.length:max));i=0;while(i<max){highest=linesArray.indexOf(Math.min.apply(window,linesArray));if(linesArray[highest]<255){linesArray[highest]=255;higharray[higharray.length]=highest}i+=1}return higharray};"use strict";canvas=(typeof options.canvas!=="string"?options.canvas:document.getElementById(options.canvas));imgsrc=(options.img!==undefined?(typeof options.img!=="string"?options.img.src:options.img):canvas.getAttribute("data-src"));height=(options.height!==undefined?options.height:canvas.getAttribute("height"));width=(options.width!==undefined?options.width:canvas.getAttribute("width"));cxt=canvas.getContext("2d");ocanvas=document.getElementById("originalCanvas");ocxt=ocanvas.getContext("2d");ignoreRows=void 0;ignoreCols=void 0;pixel=0;opixel=0;img=void 0;x=void 0;y=void 0;original=ocxt.getImageData(0,0,ocanvas.getAttribute("width"),ocanvas.getAttribute("height"));outputData=cxt.createImageData(width,height);edgeDetect({canvas:"Canvas"});ignoreRows=boringLines(edgeDetectLines[1],ocanvas.getAttribute("height")-height);ignoreCols=boringLines(edgeDetectLines[0],ocanvas.getAttribute("width")-width);canvas.width=width;canvas.height=height;y=0;while(y<ocanvas.getAttribute("height")){x=0;while(x<ocanvas.getAttribute("width")){if((ignoreRows.indexOf(y)===-1)&&(ignoreCols.indexOf(x)===-1)){outputData.data[pixel]=original.data[opixel];outputData.data[pixel+=1]=original.data[opixel+=1];outputData.data[pixel+=1]=original.data[opixel+=1];outputData.data[pixel+=1]=255;opixel+=1;opixel+=1;pixel+=1}else{opixel+=1;opixel+=1;opixel+=1;opixel+=1}x+=1}y+=1}img=new Image();img.src=imgsrc;return cxt.putImageData(outputData,0,0,0,0,width,height)};edgeDetectLines=[];
